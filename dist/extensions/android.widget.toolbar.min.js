this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e='<?xml version="1.0" encoding="utf-8"?>\n<resources>\n!1\n\t<style name="{&appTheme}" parent="{~parentTheme}">\n!items\n\t\t<item name="{&name}">{&value}</item>\n!items\n\t</style>\n!1\n\t<style name="{&appTheme}.NoActionBar">\n\t\t<item name="windowActionBar">false</item>\n\t\t<item name="windowNoTitle">true</item>\n\t</style>\n\t<style name="{&appTheme}.AppBarOverlay" parent="{~appBarOverlay}" />\n\t<style name="{&appTheme}.PopupOverlay" parent="{~popupOverlay}" />\n</resources>',t=android.lib.base.Resource,a=androme.lib.constant,n=androme.lib.dom,r=androme.lib.enumeration,l=androme.lib.util,o=androme.lib.xml,d=android.lib.constant,i=android.lib.enumeration,s=android.lib.util;class p extends androme.lib.base.Extension{constructor(e,t,a,n){super(e,t,a,n),this.require("android.widget.menu")}init(e){if(this.included(e)&&(Array.from(e.children).some(e=>"NAV"===e.tagName&&!l.includes(e.dataset.use,a.EXT_NAME.EXTERNAL)&&(e.dataset.use=(l.hasValue(e.dataset.use)?`${e.dataset.use}, `:"")+a.EXT_NAME.EXTERNAL,!0)),e.dataset.target)){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!l.includes(t.dataset.use,"android.widget.coordinator")&&this.application.parseElements.add(e)}return!1}processNode(e,a){const u=this.application,c=u.controllerHandler,h=l.hasValue(e.dataset.target),m=Object.assign({},this.options[e.element.id]),N=s.createAttribute(m.self),O=s.createAttribute(m.appBar),g=s.createAttribute(m.collapsingToolbar),f=p.findNestedByName(e.element,"android.widget.menu"),A=e.has("backgroundImage"),T=[],y=[];let E=h?0:a.renderDepth+1,b=e.filter(e=>!e.positioned).length;Array.from(e.element.children).forEach(e=>{if("IMG"===e.tagName){if(l.hasValue(e.dataset.navigationIcon)){const a=t.addImageSrcSet(e,d.PREFIX_ANDROID.MENU);""!==a&&(l.defaultWhenNull(N,"app","navigationIcon",`@drawable/${a}`),"none"!==n.getStyle(e).display&&b--)}if(l.hasValue(e.dataset.collapseIcon)){const a=t.addImageSrcSet(e,d.PREFIX_ANDROID.MENU);""!==a&&(l.defaultWhenNull(N,"app","collapseIcon",`@drawable/${a}`),"none"!==n.getStyle(e).display&&b--)}}if(l.hasValue(e.dataset.target))b--;else{const t=n.getElementAsNode(e);if(t)switch(e.dataset.targetModule){case"appBar":T.push(t),b--;break;case"collapsingToolbar":y.push(t),b--}}});const I="collapsingToolbar"in m||y.length,R="appBar"in m||T.length||I;let _="",S="";I?l.defaultWhenNull(N,"app","layout_collapseMode","pin"):(R||l.defaultWhenNull(N,"android","fitsSystemWindows","true"),l.defaultWhenNull(N,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),A?(l.defaultWhenNull(T.length?O:N,"android","background",`@drawable/${t.addImageUrl(e.css("backgroundImage"))}`),e.exclude({resource:r.NODE_RESOURCE.IMAGE_SOURCE})):l.defaultWhenNull(N,"app","layout_scrollFlags","scroll|enterAlways")),T.length?l.defaultWhenNull(O,"android","layout_height","?android:attr/actionBarSize"):(l.defaultWhenNull(N,"android","layout_height","?android:attr/actionBarSize"),e.exclude({procedure:r.NODE_PROCEDURE.LAYOUT})),f&&R&&(N.app.popupTheme&&(S=N.app.popupTheme.replace("@style/","")),N.app.popupTheme="@style/AppTheme.PopupOverlay");const D=E+(R?1:0)+(I?1:0),P=u.extensionManager.optionValueAsBoolean(d.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue");e.setControlType(d.SUPPORT_ANDROID.TOOLBAR,i.CONTAINER_NODE.BLOCK);let w=c.renderNodeStatic(d.SUPPORT_ANDROID.TOOLBAR,D,t.formatOptions(N,P),"match_parent","wrap_content",e,b>0);if(I&&A){const a=s.createAttribute(m.backgroundImage);let n="center";switch(e.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":n="centerCrop";break;case"contain":case"100% 100%":n="fitXY";break;case"auto":n="matrix"}l.defaultWhenNull(a,"android","id",`${e.documentId}_image`),l.defaultWhenNull(a,"android","src",`@drawable/${t.addImageUrl(e.css("backgroundImage"))}`),l.defaultWhenNull(a,"android","scaleType",n),l.defaultWhenNull(a,"android","fitsSystemWindows","true"),l.defaultWhenNull(a,"app","layout_collapseMode","parallax"),w=c.renderNodeStatic(d.CONTAINER_ANDROID.IMAGE,D,t.formatOptions(a,P),"match_parent","match_parent")+w,e.exclude({resource:r.NODE_RESOURCE.IMAGE_SOURCE})}let W,B,C="";if(R&&(l.defaultWhenNull(O,"android","id",`${e.documentId}_appbar`),l.defaultWhenNull(O,"android","layout_height",e.hasHeight?l.formatPX(e.height):"wrap_content"),l.defaultWhenNull(O,"android","fitsSystemWindows","true"),f?(O.android.theme&&(_=O.android.theme),O.android.theme="@style/AppTheme.AppBarOverlay",e.data("android.widget.toolbar","themeData",{target:h,appBarOverlay:_,popupOverlay:S})):l.defaultWhenNull(O,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(W=this.createPlaceholder(e,T)).parent=e.parent,W.controlId=s.stripId(O.android.id),W.setControlType(d.SUPPORT_ANDROID.APPBAR,i.CONTAINER_NODE.BLOCK),u.processing.cache.append(W,T.length>0),C=c.renderNodeStatic(d.SUPPORT_ANDROID.APPBAR,h?-1:E,t.formatOptions(O,P),"match_parent","wrap_content",W,!0),I&&(E++,l.defaultWhenNull(g,"android","id",`${e.documentId}_collapsingtoolbar`),l.defaultWhenNull(g,"android","fitsSystemWindows","true"),A||l.defaultWhenNull(g,"app","contentScrim","?attr/colorPrimary"),l.defaultWhenNull(g,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),l.defaultWhenNull(g,"app","toolbarId",e.documentId),(B=this.createPlaceholder(e,y)).parent=W,B))){B.each(e=>e.dataset.target=B.controlId),B.setControlType(d.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,i.CONTAINER_NODE.BLOCK),u.processing.cache.append(B,y.length>0);const e=c.renderNodeStatic(d.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,h&&!R?-1:E,t.formatOptions(g,P),"match_parent","match_parent",B,!0);C=o.replacePlaceholder(C,W.id,e)}return W?(w=o.replacePlaceholder(C,B?B.id:W.id,w),W.render(h?W:a),B?(B.parent=W,B.render(W),e.parent=B):e.parent=W,e.data("android.widget.toolbar","outerParent",W.documentId),e.render(e.parent)):B?(B.render(h?B:a),e.parent=B,e.render(B)):e.render(h?e:a),e.containerType=i.CONTAINER_NODE.BLOCK,e.exclude({resource:r.NODE_RESOURCE.FONT_STYLE}),{output:w}}processChild(e){let t=!1;return e.imageElement&&(l.hasValue(e.dataset.navigationIcon)||l.hasValue(e.dataset.collapseIcon))&&(e.hide(),t=!0),{output:"",next:t}}postProcedure(e){const t=l.optionalAsString(p.findNestedByName(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==t){const a=Object.assign({},this.options[e.element.id]),n=s.createAttribute(a.self);l.defaultWhenNull(n,"app","menu",`@menu/${t}`),e.app("menu",n.app.menu)}const a=e.data("android.widget.toolbar","themeData");a&&this.setStyleTheme(a)}setStyleTheme(t){if(this.application.resourceHandler.fileHandler){const a=Object.assign({},this.options.resource);l.defaultWhenNull(a,"appTheme",function(e){for(const t of e){const e=/<style\s+name="([\w$]+)"\s+parent="Theme\.[\w$.]+"/.exec(t.content);if(e)return e[1]}return""}(this.application.resourceHandler.fileHandler.assets)||"AppTheme"),l.defaultWhenNull(a,"parentTheme","Theme.AppCompat.Light.DarkActionBar");const n={appTheme:a.appTheme,appBarOverlay:t.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar",popupOverlay:t.popupOverlay||"ThemeOverlay.AppCompat.Light",1:[{appTheme:a.appTheme,parentTheme:a.parentTheme,items:[]}]};t.target?n[1]=!1:n.items=n[1][0].items,l.defaultWhenNull(a,"output","path","res/values"),l.defaultWhenNull(a,"output","file","android.widget.toolbar.xml"),this.application.resourceHandler.addStyleTheme(e,n,a)}}createPlaceholder(e,t){const a=this.application.createNode(n.createElement(e.actualParent?e.actualParent.baseElement:null,e.block));a.inherit(e,"base"),a.exclude({resource:r.NODE_RESOURCE.ALL}),a.positioned=!0;let l=Number.MAX_VALUE;return t.forEach(e=>{l=Math.min(l,e.siblingIndex),e.parent=a}),a.siblingIndex=l,a}}const u=new p("android.widget.toolbar",2);return androme&&androme.includeAsync(u),u}();
